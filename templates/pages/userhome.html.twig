{% extends 'base.html.twig' %}

{% block title %}Espace utilisateur{% endblock %}

{% block body %}
    <div class="example-wrapper">
        <h2>Bonjour {{ user.getFirstname }},</h2>
        <p class="text-secondary fw-bold mt-5">Votre compte</p>
        <div class="bg-light border border-primary border-3 w-25 pb-3 mx-2">
            {% include 'users/show.html.twig' %}
        </div>
        {% for role in user.roles %}
            {% if role == "ROLE_ADMIN" %}
                <div class="mt-5 mx-3"><a href="{{ path('admin_index') }}">Liste des utilisateurs</a></div>
            {% endif %}
        {% endfor %}
        {% for role in user.roles %}
            {% if role == "ROLE_RECRUITER" and user.getValidated == 1 and user.getCompany is not null %}
                <div class="mt-5"><a href="{{ path('jobs_index') }}">Voir la liste des emplois que vous avez publiés</a></div>
                <div class="mt-5"><a href="{{ path('jobs_new') }}">Ajouter une offre d'emploi</a></div>
                <div class="d-flex">
                    <div class="mt-5 text-primary"> Candidatures validées: </div>
                    {% for postulatedJob in postulatedJobsToValidate %}
                        {% if postulatedJob.validated == 1 %}
                            <div class="w-25 table">
                                {% include 'jobs/postulatedJob.html.twig' %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}
        {% for job in jobsPostulated %}
            <div><a href="{{ path('jobs_postulate', {'id': job.id}) }}">{{ job.title }}</a></div>
        {% endfor %}
        {% for role in user.roles %}
            {% if role == "ROLE_CONSULTANT" %}
                <div class="d-flex">
                    <div class="mt-5 text-info">Comptes à valider: </div>
                    {% for user in users %}
                        {% set userRole = "ROLE_USER" %}
                        {% for role in user.roles %}
                            {% if role == "ROLE_RECRUITER" %}
                                {% set userRole = "ROLE_RECRUITER" %}
                            {% endif %}
                            {% if role == "ROLE_ADMIN" or role == "ROLE_CONSULTANT" %}
                                {% set userRole = "ROLE_OTHER" %}
                            {% endif %}
                        {% endfor %}
                        {% if user.validatedBy is null and userRole != "ROLE_OTHER" %}
                            <div class="w-25 table mx-5">
                                {% include 'users/toValidate.html.twig' %}
                                {% if userRole == 'ROLE_RECRUITER' %}
                                    {% if user.company is not null %}
                                        <p>RECRUTEUR</p>
                                        <p>{{ user.company.name }} - {{ user.company.address }}</p>
                                    {% endif%}
                                {% endif %}
                                <a class="btn btn-success" href="{{ path('users_validate',{'id': user.id}) }}">Valider</a>
                                <a class="btn btn-danger" href="{{ path('users_reject',{'id': user.id}) }}">Rejeter</a>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="d-flex">
                    <div class="mt-5 text-info"> Offres d'emploi à validader: </div>
                    {% for job in jobs %}
                        {% if job.checkedBy is null %}
                            <div class="w-25 table">
                                {% include 'jobs/toValidate.html.twig' %}
                                <a class="btn btn-success" href="{{ path('jobs_validate',{'id': job.id}) }}">Valider</a>
                                <a class="btn btn-danger" href="{{ path('jobs_reject',{'id': job.id}) }}">Rejeter</a>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="d-flex">
                    <div class="mt-5 text-info"> candidatures à valider: </div>
                    {% for postulatedJob in postulatedJobsToValidate %}
                        {% if postulatedJob.checkedBy is null %}
                            <div class="w-25 table">
                                {% include 'jobs/postulatedJob.html.twig' %}
                                <a class="btn btn-success" href="{{ path('PostulatedJob_validate',{'id': postulatedJob.id}) }}">Valider</a>
                                <a class="btn btn-danger" href="{{ path('PostulatedJob_reject',{'id': postulatedJob.id}) }}">Rejeter</a>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
        {%endfor %}
    </div>
{% endblock %}
